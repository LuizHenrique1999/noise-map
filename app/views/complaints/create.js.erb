document.querySelector("#complaint_description").classList.remove('is-danger')
message = document.querySelector("#invalid_description_message")
if(message){
  message.parentNode.removeChild(message)
}

if(map.hasLayer(marker)){
  map.removeLayer(marker)
}

var new_marker_latitude = <%= @marker.latitude %>
var new_marker_longitude = <%= @marker.longitude %>

var new_marker = L.marker([new_marker_latitude, new_marker_longitude], { icon: complaintIcon }).bindPopup("<%= @marker.description %>")

clusterLayer.addLayer(new_marker)
clusterLayer.refreshClusters()

heatmapData.data.push({lat: new_marker_latitude, lng: new_marker_longitude, value: 1})
heatmapLayer.addData({lat: new_marker_latitude, lng: new_marker_longitude, value: 1})

address_field.value = ""
latitude_field.value = ""
longitude_field.value = ""
noise_type_field.value = 1
description_field.value = ""

sidebar.close()
new_marker.openPopup()